<?php
	
//Models
use App\ChiefTarget;
use App\ChiefMeasure;
use App\ChiefObjective;
use App\Chief;
use App\UserChief;
use App\ChiefAccomplishment;
use App\ChiefOwner;
use App\ChiefInitiative;
use App\ChiefFunding;

use App\StaffAccomplishment;


	$selectedYear = Session::get('year', 'default');	

    $chief_id = Session::get('chief_user_id', 'default');
    $chief_user = UserChief::where('UserChiefID', '=', $chief_id)
                            ->first();

    $chief_id = Session::get('chief_user_id', 'default'); //get the UserChiefID stored in session.
    $chief = UserChief::where('UserChiefID', '=', $chief_id)->select('ChiefID')->lists('ChiefID'); //Get the Unit of the chief      
        
    $chief = Chief::where('ChiefID', '=', $chief_user->ChiefID)->first();
    $chief_objectives = ChiefObjective::all();
    $chief_measures = ChiefMeasure::with('chief')->where('ChiefID', '=', $chief_user->ChiefID)->get();

    $accomplishments = ChiefTarget::with('chief_measure')
                                    ->with('chief_measure.chief_objective')
                                    ->with('chief_measure.staff_measures.staff_accomplishments')
                                    ->with('chief_measure.staff_measures.staff_accomplishments.staff')
                                    ->with('chief_measure.staff_measures.unit_measures.unit_accomplishments')
                                    ->with('chief_accomplishment')
                                    ->with('chief_owner')
                                    ->with('chief_initiative')
                                    ->with('chief_funding')
                                    ->with('user_chief')
                                    ->with('user_chief.rank')
                                    ->whereBetween('TargetDate', array($selectedYear.'-01-01', $selectedYear.'-12-31'))
                                    ->where('ChiefID', '=', $chief_user->ChiefID)
                                    ->get();

	foreach ($accomplishments as $accomplishment)
	{
		//dd($accomplishment);
	}
	//dd($accomplishments);	
	$logoPath = 'img/pnp_logo2.png';
	$chieflogoPath = 'uploads/chiefpictures/cropped/'.$chief->PicturePath;
?>

<!DOCTYPE html>

<head>
    <title>Report | PNP</title>
    <style type="text/css">
    table
    {
    	font-size: 10;
    	text-align: center;
    	width: 875;
    	border-collapse: collapse;
    	page-break-inside: auto;
    }
    tr
    { 
    	page-break-inside: avoid;
    	page-break-after: auto; 
    }
    p, strong
    {
    	font-family: helvetica;
    }
    img 
    {
    	position: absolute;
    	left: 70px;
    	top: 5px;
	}
	.unitlogo
	{
    	position: absolute;
    	left: 960px;
    	top: 17px;
	}
    .label 
    {
        display: inline;
        padding: .2em .6em .3em;
        font-size: 60%;
        font-family: helvetica;
        font-weight: bold;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: .25em;
    }
    .label-default 
    {
        background-color: #777;
    }
    </style>
</head>

<body>
	<img src="<?php echo e(URL::asset($logoPath)); ?>" style="height: 155px;width: 122px;">
	<img class="unitlogo" src="<?php echo e(URL::asset($chieflogoPath)); ?>" style="height: 120px;width: 120px;">
	<p style="text-align: center;">
		<normal style="font-size: 15px">Republic of the Philippines</normal>
		<br>
		<strong>NATIONAL POLICE COMMISSION<br>PHILIPPINE NATIONAL POLICE</strong>
		<br>
		<normal style="font-size: 15px"><?php echo e($chief->ChiefName); ?></normal>
		<br>
		<normal style="font-size: 10px">usc.pulis.net</normal>
	</p>
	<p style="font-size: 14;font-family: helvetica;font-weight: 600;text-align: center;"><?php echo e($chief->ChiefAbbreviation); ?> Scorecard for <?php echo e($selectedYear); ?></p>
    <?php if(count($accomplishments) > 0): ?>
    	<table border="1">
        	<thead style="font-weight: bold;font-family: arial,helvetica">
                <tr>
                    <td width="53" rowspan="2">OBJECTIVES</td>
                    <td colspan="3" style="text-align: left;padding-left: 3px;">MEASURES</td>
                    <td width="65" rowspan="2" style="text-align: left;padding-left: 3px;">OWNER</td>
                    <td colspan="12" height="12">TARGET/ACCOMPLISHMENT</td>
                    <td rowspan="2" style="text-align: left;padding-left: 3px;">INITIATIVES</td>
                    <td colspan="3">FUNDING</td>
                </tr>
                <tr>
                    <td width="70" style="text-align: left;padding-left: 3px;">Name</td>
                    <td>LG</td>
                    <td>LD</td>
                    <td width="35">Jan</td>
                    <td width="35">Feb</td>
                    <td width="35">Mar</td>
                    <td width="35">Apr</td>
                    <td width="35">May</td>
                    <td width="35">Jun</td>
                    <td width="35">Jul</td>
                    <td width="35">Aug</td>
                    <td width="35">Sep</td>
                    <td width="35">Oct</td>
    				<td width="35">Nov</td>
    				<td width="35">Dec</td>
                    <td width="32">Estimate</td>
                    <td width="28">Actual</td>
                    <td width="32">Variance</td>
                </tr>	
        	</thead>
        	<tbody>
        		<?php foreach($accomplishments as $accomplishment): ?>
        		<tr style="font-family: arial;">
        			<td style="vertical-align: top;text-align: left;">
        				<?php echo e($accomplishment->chief_measure->chief_objective->ChiefObjectiveName); ?>

        			</td>
        			<td  style="vertical-align: top;text-align: left;">
        				<?php echo e($accomplishment->chief_measure->ChiefMeasureName); ?>

                        <br>
                        <div style="font-size: 9px;">Contributory/ies to this Measure</div> 
                        <?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                <br>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
                    <?php if($accomplishment->chief_measure->ChiefMeasureType == 'LG'): ?>
            			<td style="background-color: #5cb85c;"></td>
                        <td></td>
                    <?php else: ?>
                        <td></td>
                        <td style="background-color: #5cb85c;"></td>
                    <?php endif; ?>
        			<td style="vertical-align: top;text-align: left;">
        				<?php echo e($accomplishment->chief_owner->ChiefOwnerContent); ?>

        			</td>
        			<td>
        				<?php echo e(round($accomplishment->JanuaryTarget, 2)); ?><b>/ </b>
                        <?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitJanuaryContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitJanuaryContribution = $unitContributeAcc->JanuaryAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->JanuaryAccomplishment+$unitJanuaryContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->FebruaryTarget, 2)); ?><b>/ </b>
                        <?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitFebruaryContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitFebruaryContribution = $unitContributeAcc->FebruaryAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->FebruaryAccomplishment+$unitFebruaryContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
    				</td>
        			<td>
        				<?php echo e(round($accomplishment->MarchTarget, 2)); ?><b>/ </b>
                        <?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitMarchContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitMarchContribution = $unitContributeAcc->MarchAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->MarchAccomplishment+$unitMarchContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->AprilTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitAprilContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitAprilContribution = $unitContributeAcc->AprilAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->AprilAccomplishment+$unitAprilContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->MayTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitMayContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitMayContribution = $unitContributeAcc->MayAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->MayAccomplishment+$unitMayContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->JuneTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitJuneContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitJuneContribution = $unitContributeAcc->JuneAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->JuneAccomplishment+$unitJuneContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->JulyTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitJulyContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitJulyContribution = $unitContributeAcc->JulyAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->JulyAccomplishment+$unitJulyContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->AugustTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitAugustContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitAugustContribution = $unitContributeAcc->AugustAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->AugustAccomplishment+$unitAugustContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->SeptemberTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitSeptemberContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitSeptemberContribution = $unitContributeAcc->SeptemberAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->SeptemberAccomplishment+$unitSeptemberContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->OctoberTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitOctoberContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitOctoberContribution = $unitContributeAcc->OctoberAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->OctoberAccomplishment+$unitOctoberContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->NovemberTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitNovemberContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitNovemberContribution = $unitContributeAcc->NovemberAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->NovemberAccomplishment+$unitNovemberContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td>
        				<?php echo e(round($accomplishment->DecemberTarget, 2)); ?><b>/ </b>
        				<?php foreach($accomplishment->chief_measure->staff_measures as $contributor): ?>
                            <?php foreach($contributor->staff_accomplishments as $contributory): ?>
                                <?php
                                    $unitDecemberContribution = 0;
                                ?>
                                <?php foreach($contributor->unit_measures as $unitContribute): ?>
                                    <?php foreach($unitContribute->unit_accomplishments as $unitContributeAcc): ?>
                                    <?php
                                        $unitDecemberContribution = $unitContributeAcc->DecemberAccomplishment;
                                    ?>
                                    <?php endforeach; ?>
                                <?php endforeach; ?> 
                                <br>
                                <normal>
                                    <b>+<?php echo e(round(($contributory->DecemberAccomplishment+$unitDecemberContribution), 2)); ?></b> 
                                    <span class="label label-default"><?php echo e($contributory->staff->StaffAbbreviation); ?></span>
                                </normal>
                            <?php endforeach; ?>
                        <?php endforeach; ?>
        			</td>
        			<td  style="vertical-align: top;text-align: left;">
        				<?php echo e($accomplishment->chief_initiative->ChiefInitiativeContent); ?>

        			</td>
        			<td style="text-align: right;">
        				<?php echo e(round($accomplishment->chief_funding->ChiefFundingEstimate, 2)); ?>

        			</td>
        			<td style="text-align: right;">
        				<?php echo e(round($accomplishment->chief_funding->ChiefFundingActual, 2)); ?>

        			</td>
        			<td style="text-align: right;">
        				<?php echo e(round(($accomplishment->chief_funding->ChiefFundingEstimate - $accomplishment->chief_funding->ChiefFundingActual), 2)); ?>

        			</td>
        		</tr>
        		<?php endforeach; ?>
        	</tbody>
    	</table>
    <?php else: ?>
        <p>No Accomplisments found for the year <?php echo e($selectedYear); ?></p>
    <?php endif; ?>
</body>