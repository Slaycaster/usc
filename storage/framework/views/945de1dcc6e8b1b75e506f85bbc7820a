<?php
	
//Models
use App\StaffTarget;
use App\StaffMeasure;
use App\StaffObjective;
use App\Staff;
use App\UserStaff;
use App\StaffAccomplishment;
use App\StaffOwner;
use App\StaffInitiative;
use App\StaffFunding;

	$selectedYear = Session::get('year', 'default');	

    $staff_id = Session::get('staff_user_id', 'default');
    $staff_user = UserStaff::where('UserStaffID', '=', $staff_id)
                            ->first();

    $staff_id = Session::get('staff_user_id', 'default'); //get the UserstaffID stored in session.
    $staff = UserStaff::where('UserStaffID', '=', $staff_id)->select('StaffID')->first(); //Get the Unit of the chief
      
    $staff = Staff::where('StaffID', '=', $staff_user->StaffID)->first();
    $staff_objectives = StaffObjective::all();
    $staff_measures = StaffMeasure::with('staff')->where('StaffID', '=', $staff_user->StaffID)->get();
    
    $accomplishments = StaffTarget::with('staff_measure')
                                    ->with('staff_measure.staff_objective')
                                    ->with('staff_measure.unit_measures.unit_accomplishments')
                                    ->with('staff_measure.unit_measures.unit_accomplishments.unit')
                                    ->with('staff_owner')
                                    ->with('staff_funding')
                                    ->with('staff_initiative')
                                    ->with('staff_accomplishment')
                                    ->with('user_staff')
                                    ->with('user_staff.rank')
                                    ->whereBetween('TargetDate', array($selectedYear.'-01-01', $selectedYear.'-12-31'))
                                    ->where('StaffID', '=', $staff->StaffID)
                                    ->get();

	foreach ($accomplishments as $accomplishment)
	{
		//dd($accomplishment);
	}
	//dd($accomplishments);	
	$logoPath = 'img/pnp_logo2.png';
	$stafflogoPath = 'uploads/staffpictures/cropped/'.$staff->PicturePath;
?>

<!DOCTYPE html>

<head>
    <title>Report | PNP</title>
    <style type="text/css">
    table
    {
    	font-size: 8;
    	text-align: center;
    	width: 875;
    	border-collapse: collapse;
    	page-break-inside: auto;
    }
    tr
    { 
    	page-break-inside: avoid;
    	page-break-after: auto; 
    }
    p, strong
    {
    	font-family: helvetica;
    }
    img 
    {
    	position: absolute;
    	left: 10px;
    	top: 5px;
	}
	.unitlogo
	{
    	position: absolute;
    	left: 1000px;
    	top: 20px;
	}
    </style>
</head>

<body>
	<img src="<?php echo e(URL::asset($logoPath)); ?>" style="height: 155px;width: 125px;">
	<img class="unitlogo" src="<?php echo e(URL::asset($stafflogoPath)); ?>" style="height: 120px;width: 120px;">
	<p style="text-align: center;">
		<normal style="font-size: 15px">Republic of the Philippines</normal>
		<br>
		<strong>NATIONAL POLICE COMMISSION<br>PHILIPPINE NATIONAL POLICE</strong>
		<br>
		<normal style="font-size: 15px"><?php echo e($staff->StaffName); ?></normal>
		<br>
		<normal style="font-size: 10px">usc.pulis.net</normal>
	</p>
	<p style="font-size: 14;font-family: helvetica;font-weight: 600;text-align: center;"><?php echo e($staff->StaffAbbreviation); ?> Scorecard for <?php echo e($selectedYear); ?></p>
    <?php if(count($accomplishments) > 0): ?>
    	<table border="1">
        	<thead style="font-weight: bold;font-family: arial,helvetica">
                <tr>
                    <td width="55" rowspan="2">OBJECTIVES</td>
                    <td colspan="2">MEASURES</td>
                    <td width="80" rowspan="2" >OWNER</td>
                    <td colspan="12" height="12">TARGET/ACCOMPLISHMENT</td>
                    <td rowspan="2">INITIATIVES</td>
                    <td colspan="3">FUNDING</td>
                </tr>
                <tr>
                    <td width="78">Name</td>
                    <td width="22">Type</td>
                    <td width="35">Jan</td>
                    <td width="35">Feb</td>
                    <td width="35">Mar</td>
                    <td width="35">Apr</td>
                    <td width="35">May</td>
                    <td width="35">Jun</td>
                    <td width="35">Jul</td>
                    <td width="35">Aug</td>
                    <td width="35">Sep</td>
                    <td width="35">Oct</td>
    				<td width="35">Nov</td>
    				<td width="35">Dec</td>
                    <td width="32">Estimate</td>
                    <td width="28">Actual</td>
                    <td width="32">Variance</td>
                </tr>	
        	</thead>
        	<tbody>
        		<?php foreach($accomplishments as $accomplishment): ?>
        		<tr style="font-family: arial;">
        			<td>
        				<?php echo e($accomplishment->staff_measure->staff_objective->StaffObjectiveName); ?>

        			</td>
        			<td>
        				<?php echo e($accomplishment->staff_measure->StaffMeasureName); ?>

                        <br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->staff_measure->StaffMeasureType); ?>

        			</td>
        			<td>
        				<?php echo e($accomplishment->staff_owner->StaffOwnerContent); ?>

        			</td>
        			<td>
        				<?php echo e($accomplishment->JanuaryTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->JanuaryAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->JanuaryAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->FebruaryTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->FebruaryAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->FebruaryAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
    				</td>
        			<td>
        				<?php echo e($accomplishment->MarchTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->MarchAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->MarchAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->AprilTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->AprilAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->AprilAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->MayTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->MayAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->MayAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->JuneTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->JuneAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->JuneAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->JulyTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->JulyAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->JulyAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->AugustTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->AugustAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->AugustAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->SeptemberTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->SeptemberAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->SeptemberAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->OctoberTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->OctoberAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->OctoberAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->NovemberTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->NovemberAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->NovemberAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->DecemberTarget); ?><b>/ </b><?php echo e($accomplishment->staff_accomplishment->DecemberAccomplishment); ?>

        				<br>
                        <div style="font-size: 9px">
                            <?php foreach($accomplishment->staff_measure->unit_measures as $contributor): ?>
                                <?php foreach($contributor->unit_accomplishments as $contributory): ?>
                                    <strong>+<?php echo e($contributory->DecemberAccomplishment); ?></strong> (<?php echo e($contributory->unit->UnitAbbreviation); ?>)
                                <?php endforeach; ?>
                            <?php endforeach; ?>
                        </div>
        			</td>
        			<td>
        				<?php echo e($accomplishment->staff_initiative->StaffInitiativeContent); ?>

        			</td>
        			<td>
        				<?php echo e($accomplishment->staff_funding->StaffFundingEstimate); ?>

        			</td>
        			<td>
        				<?php echo e($accomplishment->staff_funding->StaffFundingActual); ?>

        			</td>
        			<td>
        				<?php echo e(round(($accomplishment->staff_funding->StaffFundingEstimate - $accomplishment->staff_funding->StaffFundingActual), 2)); ?>

        			</td>
        		</tr>
        		<?php endforeach; ?>
        	</tbody>
    	</table>
    <?php else: ?>
        <p>No Accomplisments found for the year <?php echo e($selectedYear); ?></p>
    <?php endif; ?>
</body>